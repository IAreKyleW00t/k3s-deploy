---
- name: Create Production Let's Encrypt ClusterIssuer
  community.kubernetes.k8s:
    state: present
    definition:
      apiVersion: cert-manager.io/v1
      kind: ClusterIssuer
      metadata:
        name: letsencrypt
      spec:
        acme:
          email: "{{ certmanager_email }}"
          server: https://acme-v02.api.letsencrypt.org/directory
          privateKeySecretRef:
            name: letsencrypt-prod
          solvers:
          - http01:
              ingress:
                class: "{{ certmanager_ingress_class }}"
  environment:
    KUBECONFIG: /etc/rancher/k3s/k3s.yaml
  become: yes
  tags: cluster-issuers

- name: Create Staging Let's Encrypt ClusterIssuer
  community.kubernetes.k8s:
    state: present
    definition:
      apiVersion: cert-manager.io/v1
      kind: ClusterIssuer
      metadata:
        name: letsencrypt-staging
      spec:
        acme:
          email: "{{ certmanager_email }}"
          server: https://acme-staging-v02.api.letsencrypt.org/directory
          privateKeySecretRef:
            name: letsencrypt-staging
          solvers:
          - http01:
              ingress:
                class: "{{ certmanager_ingress_class }}"
  environment:
    KUBECONFIG: /etc/rancher/k3s/k3s.yaml
  become: yes
  tags: cluster-issuers
